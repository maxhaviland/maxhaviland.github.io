{"version":3,"sources":["../../src/use-popper.ts"],"names":["mergeRefs","React","getArrowStyles","getBoxShadow","toTransformOrigin","usePopper","useBasePopper","props","placement","preventOverflow","fixed","flip","arrowSize","arrowShadowColor","gutter","arrowPadding","offset","offsetProp","matchWidth","modifiers","referenceNode","setReferenceNode","useState","popperNode","setPopperNode","arrowNode","setArrowNode","customModifiers","useMemo","name","options","phase","enabled","element","padding","requires","fn","state","styles","popper","width","rects","reference","effect","elements","style","offsetWidth","arrow","modifiersData","centerOffset","setAttribute","removeAttribute","popperJS","strategy","concat","useEffect","forceUpdate","finalPlacement","arrowStyles","popperArrowStyles","getReferenceProps","useCallback","_ref","ref","getPopperProps","attributes","getArrowWrapperProps","getArrowProps","boxShadow","position","zIndex","height","transform","transformOrigin","update"],"mappings":"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","sourcesContent":["import { mergeRefs, PropGetter } from \"@chakra-ui/utils\"\nimport { Modifier, Placement } from \"@popperjs/core\"\nimport * as React from \"react\"\nimport { getArrowStyles, getBoxShadow, toTransformOrigin } from \"./popper.utils\"\nimport { usePopper as useBasePopper } from \"./react-popper\"\n\nexport type { Placement }\n\nexport interface UsePopperProps {\n  gutter?: number\n  placement?: Placement\n  offset?: [number, number]\n  preventOverflow?: boolean\n  fixed?: boolean\n  flip?: boolean\n  arrowSize?: number\n  arrowShadowColor?: string\n  /**\n   * The distance of the arrow to its next border (numeric)\n   * E.g. arrowPadding = borderRadius * 2\n   */\n  arrowPadding?: number\n  matchWidth?: boolean\n  modifiers?: Modifier<string, any>[]\n}\n\nexport function usePopper(props: UsePopperProps = {}) {\n  const {\n    placement = \"bottom\",\n    preventOverflow = true,\n    fixed = false,\n    flip = true,\n    arrowSize = 8,\n    arrowShadowColor,\n    gutter = 8,\n    arrowPadding = 4,\n    offset: offsetProp,\n    matchWidth,\n    modifiers = [],\n  } = props\n\n  const [\n    referenceNode,\n    setReferenceNode,\n  ] = React.useState<HTMLButtonElement | null>(null)\n  const [popperNode, setPopperNode] = React.useState<HTMLDivElement | null>(\n    null,\n  )\n  const [arrowNode, setArrowNode] = React.useState<HTMLDivElement | null>(null)\n  const offset = offsetProp ?? [0, gutter]\n\n  /**\n   * recommended via popper docs\n   * @see https://popper.js.org/react-popper/v2/faq/#why-i-get-render-loop-whenever-i-put-a-function-inside-the-popper-configuration\n   */\n  type Modifiers = Partial<Modifier<any, unknown>>[]\n  const customModifiers = React.useMemo<Modifiers>(\n    () => [\n      // @see https://popper.js.org/docs/v2/modifiers/offset/\n      {\n        name: \"offset\",\n        options: {\n          offset: offset ?? [0, gutter],\n        },\n        phase: \"main\",\n      },\n      // @see https://popper.js.org/docs/v2/modifiers/prevent-overflow/\n      {\n        name: \"preventOverflow\",\n        enabled: !!preventOverflow,\n        phase: \"main\",\n      },\n      // @see https://popper.js.org/docs/v2/modifiers/arrow/\n      {\n        name: \"arrow\",\n        enabled: !!arrowNode,\n        options: { element: arrowNode, padding: arrowPadding },\n        phase: \"main\",\n      },\n      // @see https://popper.js.org/docs/v2/modifiers/flip/\n      {\n        name: \"flip\",\n        enabled: flip,\n        options: {\n          padding: 8,\n        },\n        phase: \"main\",\n      },\n      {\n        name: \"matchWidth\",\n        enabled: !!matchWidth,\n        phase: \"beforeWrite\",\n        requires: [\"computeStyles\"],\n        fn: ({ state }) => {\n          state.styles.popper.width = `${state.rects.reference.width}px`\n        },\n        effect: ({ state }) => () => {\n          const reference = state.elements.reference as HTMLElement\n          state.elements.popper.style.width = `${reference.offsetWidth}px`\n        },\n      },\n      {\n        name: \"applyArrowHide\",\n        enabled: true,\n        phase: \"write\",\n        fn({ state }) {\n          const { arrow } = state.elements\n          if (arrow) {\n            if (state.modifiersData.arrow?.centerOffset !== 0) {\n              arrow.setAttribute(\"data-hide\", \"\")\n            } else {\n              arrow.removeAttribute(\"data-hide\")\n            }\n          }\n        },\n      },\n    ],\n    [\n      arrowNode,\n      arrowPadding,\n      flip,\n      preventOverflow,\n      offset,\n      gutter,\n      matchWidth,\n    ],\n  )\n\n  const popperJS = useBasePopper(referenceNode as any, popperNode as any, {\n    placement,\n    strategy: fixed ? \"fixed\" : \"absolute\",\n    modifiers: customModifiers.concat(modifiers),\n  })\n\n  /**\n   * Ensure the popper will be correctly positioned with an extra update\n   */\n  React.useEffect(() => {\n    popperJS.forceUpdate?.()\n  })\n\n  const finalPlacement = popperJS.state?.placement ?? placement\n\n  const arrowStyles = getArrowStyles({\n    placement: finalPlacement,\n    popperArrowStyles: popperJS.styles.arrow,\n    arrowSize,\n  })\n\n  const getReferenceProps: PropGetter = React.useCallback(\n    (props = {}, _ref = null) => {\n      return {\n        ...props,\n        ref: mergeRefs(setReferenceNode, _ref),\n      }\n    },\n    [],\n  )\n\n  const getPopperProps: PropGetter = React.useCallback(\n    (props = {}, _ref = null) => {\n      return {\n        ...props,\n        ...popperJS.attributes.popper,\n        ref: mergeRefs(setPopperNode, _ref),\n        style: { ...props.style, ...popperJS.styles?.popper },\n      }\n    },\n    [popperJS.attributes, popperJS.styles],\n  )\n\n  const getArrowWrapperProps: PropGetter = React.useCallback(\n    (props = {}, _ref = null) => {\n      return {\n        ...props,\n        ...popperJS.attributes.arrow,\n        ref: mergeRefs(setArrowNode, _ref),\n        style: { ...props.style, ...arrowStyles },\n      }\n    },\n    [popperJS.attributes, arrowStyles],\n  )\n\n  const getArrowProps: PropGetter = React.useCallback(\n    (props = {}, _ref = null) => {\n      return {\n        ...props,\n        ref: _ref,\n        style: {\n          boxShadow: getBoxShadow(finalPlacement, arrowShadowColor),\n          ...props.style,\n          position: \"absolute\",\n          zIndex: -1,\n          width: \"100%\",\n          height: \"100%\",\n          transform: \"rotate(45deg)\",\n        },\n      }\n    },\n    [finalPlacement, arrowShadowColor],\n  )\n\n  return {\n    transformOrigin: toTransformOrigin(finalPlacement),\n    getReferenceProps,\n    getPopperProps,\n    getArrowWrapperProps,\n    getArrowProps,\n    state: popperJS.state,\n    forceUpdate: popperJS.forceUpdate,\n    update: popperJS.update,\n    placement: finalPlacement,\n  }\n}\n\nexport type UsePopperReturn = ReturnType<typeof usePopper>\n"],"file":"use-popper.js"}